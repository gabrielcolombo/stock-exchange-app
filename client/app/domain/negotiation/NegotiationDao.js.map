{"version":3,"sources":["../../../app-src/domain/negotiation/NegotiationDao.js"],"names":["Negotiation","NegotiationDao","constructor","connection","_connection","_store","add","negotiation","Promise","resolve","reject","request","transaction","objectStore","onsuccess","onerror","list","negotiations","cursor","openCursor","event","current","target","result","Date","value","_date","_amount","_value","push","continue","error","name","clear"],"mappings":";;;;;;AAASA,iB,kBAAAA,W;;;AAEF,YAAMC,cAAN,CAAqB;AAC1BC,oBAAYC,UAAZ,EAAwB;AACtB,eAAKC,WAAL,GAAmBD,UAAnB;AACA,eAAKE,MAAL,GAAc,cAAd;AACD;;AAEDC,YAAIC,WAAJ,EAAiB;AACf,iBAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,kBAAMC,UAAU,KAAKP,WAAL,CACbQ,WADa,CACD,CAAC,KAAKP,MAAN,CADC,EACc,WADd,EAEbQ,WAFa,CAED,KAAKR,MAFJ,EAGbC,GAHa,CAGTC,WAHS,CAAhB;;AAKAI,oBAAQG,SAAR,GAAoB,MAAML,SAA1B;;AAEAE,oBAAQI,OAAR,GAAkB,MAAM;AACtBL,qBAAO,uCAAP;AACD,aAFD;AAGD,WAXM,CAAP;AAYD;;AAEDM,eAAO;AACL,iBAAO,IAAIR,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,kBAAMO,eAAe,EAArB;;AAEA,kBAAMC,SAAS,KAAKd,WAAL,CACZQ,WADY,CACA,CAAC,KAAKP,MAAN,CADA,EACe,WADf,EAEZQ,WAFY,CAEA,KAAKR,MAFL,EAGZc,UAHY,EAAf;;AAKAD,mBAAOJ,SAAP,GAAmBM,SAAS;AAC1B,oBAAMC,UAAUD,MAAME,MAAN,CAAaC,MAA7B;;AAEA,kBAAGF,OAAH,EAAY;AACV,sBAAMd,cAAa,IAAIP,WAAJ,CACjB,IAAIwB,IAAJ,CAASH,QAAQI,KAAR,CAAcC,KAAvB,CADiB,EAEjBL,QAAQI,KAAR,CAAcE,OAFG,EAGjBN,QAAQI,KAAR,CAAcG,MAHG,CAAnB;;AAMAX,6BAAaY,IAAb,CAAkBtB,WAAlB;AACAc,wBAAQS,QAAR;AACD,eATD,MASO;AACLrB,wBAAQQ,YAAR;AACD;AACF,aAfD;;AAiBAC,mBAAOH,OAAP,GAAiBK,SAAS;AACxBV,qBAAOU,MAAME,MAAN,CAAaS,KAAb,CAAmBC,IAA1B;AACD,aAFD;AAGD,WA5BM,CAAP;AA6BD;;AAEDC,gBAAQ;AACN,iBAAO,IAAIzB,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,kBAAMC,UAAU,KAAKP,WAAL,CACbQ,WADa,CACD,CAAC,KAAKP,MAAN,CADC,EACc,WADd,EAEbQ,WAFa,CAED,KAAKR,MAFJ,EAGb4B,KAHa,EAAhB;;AAKAtB,oBAAQG,SAAR,GAAoB,MAAML,SAA1B;;AAEAE,oBAAQI,OAAR,GAAkB,MAAM;AACtBL,qBAAO,0CAAP;AACD,aAFD;AAGD,WAXM,CAAP;AAYD;;AAlEyB","file":"NegotiationDao.js","sourcesContent":["import { Negotiation } from './Negotiation.js';\r\n\r\nexport class NegotiationDao {\r\n  constructor(connection) {\r\n    this._connection = connection;\r\n    this._store = 'negotiations';\r\n  }\r\n\r\n  add(negotiation) {\r\n    return new Promise((resolve, reject) => {\r\n      const request = this._connection\r\n        .transaction([this._store], 'readwrite')\r\n        .objectStore(this._store)\r\n        .add(negotiation);\r\n\r\n      request.onsuccess = () => resolve();\r\n\r\n      request.onerror = () => {\r\n        reject('Failure while saving the negotiation.');\r\n      }\r\n    });\r\n  }\r\n\r\n  list() {\r\n    return new Promise((resolve, reject) => {\r\n      const negotiations = [];\r\n\r\n      const cursor = this._connection\r\n        .transaction([this._store], 'readwrite')\r\n        .objectStore(this._store)\r\n        .openCursor();\r\n\r\n      cursor.onsuccess = event => {\r\n        const current = event.target.result;\r\n\r\n        if(current) {\r\n          const negotiation =new Negotiation(\r\n            new Date(current.value._date),\r\n            current.value._amount,\r\n            current.value._value,\r\n          );\r\n\r\n          negotiations.push(negotiation);\r\n          current.continue();\r\n        } else {\r\n          resolve(negotiations);\r\n        }\r\n      }\r\n\r\n      cursor.onerror = event => {\r\n        reject(event.target.error.name);\r\n      }\r\n    });\r\n  }\r\n\r\n  clear() {\r\n    return new Promise((resolve, reject) => {\r\n      const request = this._connection\r\n        .transaction([this._store], 'readwrite')\r\n        .objectStore(this._store)\r\n        .clear();\r\n\r\n      request.onsuccess = () => resolve();\r\n\r\n      request.onerror = () => {\r\n        reject('Failure while clearing the negotiations.');\r\n      }\r\n    });\r\n  }\r\n\r\n}"]}