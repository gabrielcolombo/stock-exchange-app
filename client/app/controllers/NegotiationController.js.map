{"version":3,"sources":["../../app-src/controllers/NegotiationController.js"],"names":["Negotiation","NegotiationService","Negotiations","NegotiationsView","Message","MessageView","InvalidDateException","DateConverter","getNegotiationDao","Bind","getExceptionMessage","debounce","controller","bindEvent","NegotiationController","constructor","_dateInput","_amountInput","_valueInput","$","document","querySelector","bind","self","Object","assign","_message","_negotiations","_service","_init","dao","negotiations","list","forEach","negotiation","add","err","text","event","preventDefault","_createNegotiation","_clearForm","toDate","value","parseInt","parseFloat","importNegotiations","getPeriodNegotiations","filter","toArray","some","equals","existingNegotiation","focus","clear"],"mappings":"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","file":"NegotiationController.js","sourcesContent":["import { \r\n  Negotiation, NegotiationService, Negotiations\r\n} from '../domain/index.js';\r\n\r\nimport { \r\n  NegotiationsView, Message, MessageView, InvalidDateException, DateConverter\r\n} from '../ui/index.js';\r\n\r\nimport { \r\n  getNegotiationDao, Bind, getExceptionMessage, debounce, controller, bindEvent\r\n} from '../util/index.js';\r\n\r\n@controller('#date', '#amount', '#value')\r\nexport class NegotiationController {\r\n  constructor(_dateInput, _amountInput, _valueInput) {\r\n    const $ = document.querySelector.bind(document);\r\n    const self = this;\r\n\r\n    Object.assign(this, { _dateInput, _amountInput, _valueInput });\r\n\r\n    this._message = new Bind(\r\n      new Message(),\r\n      new MessageView('#message-view'),\r\n      'text',\r\n    );\r\n\r\n    this._negotiations = new Bind(\r\n      new Negotiations(),\r\n      new NegotiationsView('#negotiations'),\r\n      'add',\r\n      'clear',\r\n    );\r\n\r\n    this._service = new NegotiationService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  async _init() {\r\n    try {\r\n      const dao = await getNegotiationDao();\r\n      const negotiations = await dao.list();\r\n\r\n      negotiations.forEach((negotiation) => this._negotiations.add(negotiation));\r\n    } catch(err) {\r\n      this._message.text = getExceptionMessage(err);\r\n    }\r\n  }\r\n\r\n  @bindEvent('submit', '.form')\r\n  @debounce()\r\n  async add(event) {\r\n    try {\r\n      event.preventDefault();\r\n\r\n      const negotiation = this._createNegotiation();\r\n      const dao = await dao.add(negotiation);\r\n\r\n      this._negotiations.add(negotiation);\r\n      this._message.text = 'Negotiation added successfully!';\r\n\r\n      this._clearForm();\r\n    } catch(err) {\r\n      this._message.text = getExceptionMessage(err);\r\n    }\r\n  }\r\n\r\n  _createNegotiation() {\r\n    return new Negotiation(\r\n      DateConverter.toDate(this._dateInput.value),\r\n      parseInt(this._amountInput.value),\r\n      parseFloat(this._valueInput.value)\r\n    );\r\n  }\r\n\r\n  @bindEvent('click', '#btn-import')\r\n  @debounce()\r\n  async importNegotiations() {\r\n    try {\r\n      const negotiations = await this._service.getPeriodNegotiations();\r\n      \r\n      negotiations\r\n        .filter(negotiation => !this._negotiations\r\n          .toArray()\r\n          .some(existingNegotiation => negotiation.equals(existingNegotiation))\r\n        )\r\n        .forEach(negotiation => this._negotiations.add(negotiation));\r\n\r\n      this._message.text = 'Negotiations imported successfully!';\r\n    } catch(err) {\r\n      this._message.text = getExceptionMessage(err);\r\n    }\r\n  }\r\n\r\n  _clearForm() {\r\n    this._dateInput.value = '';\r\n    this._amountInput.value = 1;\r\n    this._valueInput.value = 0.0;\r\n\r\n    this._dateInput.focus();\r\n  }\r\n\r\n  @bindEvent('click', '#btn-clear')\r\n  async clear() {\r\n    try {\r\n      const dao = await getNegotiationDao();\r\n      await dao.clear();\r\n\r\n      this._negotiations.clear();\r\n      this._message.text = 'Negotiations cleared sucessfully!';\r\n\r\n    } catch(err) {\r\n      this._message.text = getExceptionMessage(err);\r\n    }\r\n  }\r\n}"]}