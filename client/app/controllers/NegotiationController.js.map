{"version":3,"sources":["../../app-src/controllers/NegotiationController.js"],"names":["Negotiation","NegotiationService","Negotiations","NegotiationsView","Message","MessageView","InvalidDateException","DateConverter","getNegotiationDao","Bind","getExceptionMessage","NegotiationController","constructor","$","document","querySelector","bind","self","_dateInput","_amountInput","_valueInput","_message","_negotiations","_service","_init","dao","negotiations","list","forEach","negotiation","add","err","text","event","preventDefault","_createNegotiation","_clearForm","toDate","value","parseInt","parseFloat","importNegotiations","getPeriodNegotiations","filter","toArray","some","equals","existingNegotiation","focus","clear"],"mappings":"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","file":"NegotiationController.js","sourcesContent":["import { \r\n  Negotiation, NegotiationService, Negotiations\r\n} from '../domain/index.js';\r\n\r\nimport { \r\n  NegotiationsView, Message, MessageView, InvalidDateException, DateConverter\r\n} from '../ui/index.js';\r\n\r\nimport { \r\n  getNegotiationDao, Bind, getExceptionMessage\r\n} from '../util/index.js';\r\n\r\nexport class NegotiationController {\r\n  constructor() {\r\n    const $ = document.querySelector.bind(document);\r\n    const self = this;\r\n\r\n    this._dateInput = $('#date');\r\n    this._amountInput = $('#amount');\r\n    this._valueInput = $('#value');\r\n\r\n    this._message = new Bind(\r\n      new Message(),\r\n      new MessageView('#message-view'),\r\n      'text',\r\n    );\r\n\r\n    this._negotiations = new Bind(\r\n      new Negotiations(),\r\n      new NegotiationsView('#negotiations'),\r\n      'add',\r\n      'clear',\r\n    );\r\n\r\n    this._service = new NegotiationService();\r\n\r\n    this._init();\r\n  }\r\n\r\n  async _init() {\r\n    try {\r\n      const dao = await getNegotiationDao();\r\n      const negotiations = await dao.list();\r\n\r\n      negotiations.forEach((negotiation) => this._negotiations.add(negotiation));\r\n    } catch(err) {\r\n      this._message.text = getExceptionMessage(err);\r\n    }\r\n  }\r\n\r\n  async add(event) {\r\n    try {\r\n      event.preventDefault();\r\n\r\n      const negotiation = this._createNegotiation();\r\n      const dao = await dao.add(negotiation);\r\n\r\n      this._negotiations.add(negotiation);\r\n      this._message.text = 'Negotiation added successfully!';\r\n\r\n      this._clearForm();\r\n    } catch(err) {\r\n      this._message.text = getExceptionMessage(err);\r\n    }\r\n  }\r\n\r\n  _createNegotiation() {\r\n    return new Negotiation(\r\n      DateConverter.toDate(this._dateInput.value),\r\n      parseInt(this._amountInput.value),\r\n      parseFloat(this._valueInput.value)\r\n    );\r\n  }\r\n\r\n  async importNegotiations() {\r\n    try {\r\n      const negotiations = await this._service.getPeriodNegotiations();\r\n      \r\n      negotiations\r\n        .filter(negotiation => !this._negotiations\r\n          .toArray()\r\n          .some(existingNegotiation => negotiation.equals(existingNegotiation))\r\n        )\r\n        .forEach(negotiation => this._negotiations.add(negotiation));\r\n\r\n      this._message.text = 'Negotiations imported successfully!';\r\n    } catch(err) {\r\n      this._message.text = getExceptionMessage(err);\r\n    }\r\n  }\r\n\r\n  _clearForm() {\r\n    this._dateInput.value = '';\r\n    this._amountInput.value = 1;\r\n    this._valueInput.value = 0.0;\r\n\r\n    this._dateInput.focus();\r\n  }\r\n\r\n  async clear() {\r\n    try {\r\n      const dao = await getNegotiationDao();\r\n      await dao.clear();\r\n\r\n      this._negotiations.clear();\r\n      this._message.text = 'Negotiations cleared sucessfully!';\r\n\r\n    } catch(err) {\r\n      this._message.text = getExceptionMessage(err);\r\n    }\r\n  }\r\n}"]}